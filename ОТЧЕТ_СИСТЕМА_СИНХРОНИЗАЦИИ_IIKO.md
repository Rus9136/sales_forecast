# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç: –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ —Å—ã—Ä—ã—Ö –ø—Ä–æ–¥–∞–∂ —Å iiko

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–•—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](#—Ö—Ä–∞–Ω–µ–Ω–∏–µ-—É—á–µ—Ç–Ω—ã—Ö-–∑–∞–ø–∏—Å–µ–π-–¥–ª—è-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
3. [–ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π](#–∏—Å—Ç–æ—á–Ω–∏–∫-–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π)
4. [–ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂](#–ø—Ä–æ—Ü–µ—Å—Å-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏-–ø—Ä–æ–¥–∞–∂)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
6. [–ö–∞–∫–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ](#–∫–∞–∫–∏–µ-–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è-–ø–æ–ª—É—á–∞—é—Ç-–¥–∞–Ω–Ω—ã–µ)
7. [–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#—Å—Ö–µ–º–∞-—Ä–∞–±–æ—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)

---

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂ —Å iiko —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

1. **`IikoAuthService`** (`app/services/iiko_auth.py`)
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ iiko API
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

2. **`IikoSalesLoaderService`** (`app/services/iiko_sales_loader.py`)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –∏–∑ iiko API
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

3. **`IikoDepartmentLoaderService`** (`app/services/iiko_department_loader.py`)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏–∑ iiko API
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π

4. **`ScheduledSalesLoaderService`** (`app/services/scheduled_sales_loader.py`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

---

## üîê –•—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è:
**–§–∞–π–ª:** `app/services/iiko_auth.py`

### –¢–µ–∫—É—â–∏–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```12:13:app/services/iiko_auth.py
        self.login = "Tanat"
        self.password = "7c4a8d09ca3762af61e59520943dc26494f8941b"
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è **–ø—Ä—è–º–æ –≤ –∫–æ–¥–µ** (–∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã). –≠—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–æ–∫—Ä—É–∂–µ–Ω–∏—è.

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```24:41:app/services/iiko_auth.py
    async def _refresh_token(self) -> str:
        """Refresh authentication token"""
        try:
            async with httpx.AsyncClient() as client:
                response = await client.get(
                    f"{self.base_url}/resto/api/auth",
                    params={
                        "login": self.login,
                        "pass": self.password
                    }
                )
                response.raise_for_status()
                
                self.token = response.text.strip()
                self.token_expires_at = datetime.now() + timedelta(minutes=55)  # Refresh 5 minutes before expiry
                
                logger.info("Successfully refreshed iiko authentication token")
                return self.token
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ GET-–∑–∞–ø—Ä–æ—Å –∫ `/resto/api/auth` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `login` –∏ `pass`
- –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 60 –º–∏–Ω—É—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –¢–æ–∫–µ–Ω –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–æ–º–µ–Ω—ã:
```17:20:app/services/iiko_sales_loader.py
        self.domains = [
            "https://sandy-co-co.iiko.it",
            "https://madlen-group-so.iiko.it"
        ]
```

**–û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤.**

---

## üè¢ –ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:

–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ **iiko API** —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç:
- **URL:** `{base_url}/resto/api/corporation/departments`
- **–ú–µ—Ç–æ–¥:** GET
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 
  - `key` - —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - `revisionFrom: -1` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏:

```21:47:app/services/iiko_department_loader.py
    async def fetch_departments_from_single_domain(self, base_url: str) -> List[dict]:
        """Fetch departments from a single iiko domain"""
        try:
            auth_service = IikoAuthService(base_url)
            token = await auth_service.get_auth_token()
            
            async with httpx.AsyncClient() as client:
                response = await client.get(
                    f"{base_url}/resto/api/corporation/departments",
                    params={
                        "key": token,
                        "revisionFrom": -1
                    }
                )
                response.raise_for_status()
                
                # Parse XML response
                departments = self._parse_departments_xml(response.text)
                logger.info(f"Fetched {len(departments)} departments from {base_url}")
                return departments
```

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:

–û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ **XML —Ñ–æ—Ä–º–∞—Ç–µ**, –ø–∞—Ä—Å–∏—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- `id` - UUID –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- `parent_id` - UUID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- `code` - –∫–æ–¥ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ
- `type` - —Ç–∏–ø (`DEPARTMENT`, `JURPERSON`, `CORPORATION`)
- `taxpayer_id_number` - –ò–ù–ù

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π:

```97:171:app/services/iiko_department_loader.py
    async def sync_departments(self) -> int:
        """Sync departments from iiko API to database"""
        try:
            iiko_departments = await self.fetch_departments_from_iiko()
            
            new_count = 0
            updated_count = 0
            processed_departments = set()
            remaining_departments = {dept['id']: dept for dept in iiko_departments if dept['id']}
            
            # Process departments in multiple passes to handle parent-child dependencies
            max_iterations = len(iiko_departments)
            iteration = 0
            
            while remaining_departments and iteration < max_iterations:
                iteration += 1
                departments_processed_this_iteration = 0
                
                for dept_id, iiko_dept in list(remaining_departments.items()):
                    # Check if this department can be processed
                    parent_id = iiko_dept['parent_id']
                    can_process = (parent_id is None or 
                                 parent_id in processed_departments or
                                 self.db.query(Department).filter(Department.id == parent_id).first() is not None)
                    
                    if can_process:
                        existing_dept = self.db.query(Department).filter(
                            Department.id == dept_id
                        ).first()
                        
                        if existing_dept:
                            # Update existing department
                            existing_dept.code = iiko_dept['code']
                            existing_dept.name = iiko_dept['name']
                            existing_dept.type = iiko_dept['type']
                            existing_dept.taxpayer_id_number = iiko_dept['taxpayer_id_number']
                            existing_dept.parent_id = parent_id
                            existing_dept.updated_at = datetime.utcnow()
                            existing_dept.synced_at = datetime.utcnow()
                            updated_count += 1
                        else:
                            # Create new department
                            new_dept = Department(
                                id=dept_id,
                                parent_id=parent_id,
                                code=iiko_dept['code'],
                                name=iiko_dept['name'],
                                type=iiko_dept['type'],
                                taxpayer_id_number=iiko_dept['taxpayer_id_number'],
                                synced_at=datetime.utcnow()
                            )
                            self.db.add(new_dept)
                            self.db.commit()  # Commit immediately for new records
                            new_count += 1
                        
                        processed_departments.add(dept_id)
                        del remaining_departments[dept_id]
                        departments_processed_this_iteration += 1
                
                # If no departments were processed in this iteration, break to avoid infinite loop
                if departments_processed_this_iteration == 0:
                    logger.warning(f"Could not process {len(remaining_departments)} departments due to missing parent dependencies")
                    for dept_id, dept in remaining_departments.items():
                        logger.warning(f"Department {dept_id} ({dept['name']}) has missing parent {dept['parent_id']}")
                    break
            
            # Commit any remaining updates
            self.db.commit()
            total_processed = new_count + updated_count
            logger.info(f"Successfully synced {new_count} new and {updated_count} updated departments")
            
            if remaining_departments:
                logger.warning(f"{len(remaining_departments)} departments could not be processed due to dependency issues")
            
            return total_processed
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–∑ –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- –°–æ–±–ª—é–¥–∞–µ—Ç—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—è (—Å–Ω–∞—á–∞–ª–∞ —Ä–æ–¥–∏—Ç–µ–ª–∏, –ø–æ—Ç–æ–º –¥–µ—Ç–∏)
- –ù–æ–≤—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

---

## üìä –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

```
iiko API ‚Üí IikoSalesLoaderService ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ iiko API

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST {base_url}/resto/api/v2/reports/olap`

**–ó–∞–ø—Ä–æ—Å:**
```31:57:app/services/iiko_sales_loader.py
            request_body = {
                "reportType": "SALES",
                "groupByRowFields": [
                    "Department.Id",
                    "CloseTime",
                    "OrderNum"
                ],
                "aggregateFields": [
                    "DishSumInt"
                ],
                "filters": {
                    "OpenDate.Typed": {
                        "filterType": "DateRange",
                        "periodType": "CUSTOM",
                        "from": from_date.strftime("%Y-%m-%d"),
                        "to": to_date.strftime("%Y-%m-%d")
                    },
                    "OrderDeleted": {
                        "filterType": "IncludeValues",
                        "values": ["NOT_DELETED"]
                    },
                    "DeletedWithWriteoff": {
                        "filterType": "IncludeValues",
                        "values": ["NOT_DELETED"]
                    }
                }
            }
```

**–§–∏–ª—å—Ç—Ä—ã:**
- –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ù–ï —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (`NOT_DELETED`)
- –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞–∫–∞–∑—ã –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏–π (`NOT_DELETED`)
- –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç: `from_date` - `to_date`

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```109:155:app/services/iiko_sales_loader.py
    def process_sales_data(self, sales_data: List[dict]) -> tuple[List[dict], List[dict]]:
        """Process sales data to create summary and hourly records"""
        if not sales_data:
            return [], []
        
        # Convert to DataFrame for easier processing
        df = pd.DataFrame(sales_data)
        
        # Debug: log the first few records to understand structure
        logger.info(f"Sales data sample: {sales_data[:2] if len(sales_data) > 0 else 'empty'}")
        logger.info(f"DataFrame columns: {df.columns.tolist()}")
        
        # Parse datetime and extract components - handle mixed formats
        df['CloseTime'] = pd.to_datetime(df['CloseTime'], format='mixed')
        df['date'] = df['CloseTime'].dt.date
        df['hour'] = df['CloseTime'].dt.hour
        
        # Group by department and date for daily summary
        sales_summary = df.groupby(['Department.Id', 'date']).agg(
            total_sales=('DishSumInt', 'sum')
        ).reset_index()
        
        # Group by department, date, and hour for hourly summary
        sales_by_hour = df.groupby(['Department.Id', 'date', 'hour']).agg(
            sales_amount=('DishSumInt', 'sum')
        ).reset_index()
        
        # Convert to dictionaries
        summary_records = []
        for _, row in sales_summary.iterrows():
            summary_records.append({
                'department_id': row['Department.Id'],
                'date': row['date'],
                'total_sales': float(row['total_sales'])
            })
        
        hourly_records = []
        for _, row in sales_by_hour.iterrows():
            hourly_records.append({
                'department_id': row['Department.Id'],
                'date': row['date'],
                'hour': int(row['hour']),
                'sales_amount': float(row['sales_amount'])
            })
        
        logger.info(f"Processed {len(summary_records)} daily summary records and {len(hourly_records)} hourly records")
        return summary_records, hourly_records
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏** (`SalesSummary`): —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –∑–∞ –¥–µ–Ω—å
- **–ü–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏** (`SalesByHour`): —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –∑–∞ —á–∞—Å

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

#### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏:

```157:194:app/services/iiko_sales_loader.py
    def sync_sales_summary(self, summary_records: List[dict]) -> int:
        """Sync sales summary records to database"""
        new_count = 0
        updated_count = 0
        
        for record in summary_records:
            # Check if department exists
            dept = self.db.query(Department).filter(Department.id == record['department_id']).first()
            if not dept:
                logger.warning(f"Department {record['department_id']} not found, skipping sales record")
                continue
            
            # Check if record already exists
            existing_record = self.db.query(SalesSummary).filter(
                SalesSummary.department_id == record['department_id'],
                SalesSummary.date == record['date']
            ).first()
            
            if existing_record:
                # Update existing record
                existing_record.total_sales = record['total_sales']
                existing_record.updated_at = datetime.utcnow()
                existing_record.synced_at = datetime.utcnow()
                updated_count += 1
            else:
                # Create new record
                new_record = SalesSummary(
                    department_id=record['department_id'],
                    date=record['date'],
                    total_sales=record['total_sales'],
                    synced_at=datetime.utcnow()
                )
                self.db.add(new_record)
                new_count += 1
        
        self.db.commit()
        logger.info(f"Synced {new_count} new and {updated_count} updated sales summary records")
        return new_count + updated_count
```

#### –ü–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏:

```196:235:app/services/iiko_sales_loader.py
    def sync_sales_by_hour(self, hourly_records: List[dict]) -> int:
        """Sync sales by hour records to database"""
        new_count = 0
        updated_count = 0
        
        for record in hourly_records:
            # Check if department exists
            dept = self.db.query(Department).filter(Department.id == record['department_id']).first()
            if not dept:
                logger.warning(f"Department {record['department_id']} not found, skipping hourly sales record")
                continue
            
            # Check if record already exists
            existing_record = self.db.query(SalesByHour).filter(
                SalesByHour.department_id == record['department_id'],
                SalesByHour.date == record['date'],
                SalesByHour.hour == record['hour']
            ).first()
            
            if existing_record:
                # Update existing record
                existing_record.sales_amount = record['sales_amount']
                existing_record.updated_at = datetime.utcnow()
                existing_record.synced_at = datetime.utcnow()
                updated_count += 1
            else:
                # Create new record
                new_record = SalesByHour(
                    department_id=record['department_id'],
                    date=record['date'],
                    hour=record['hour'],
                    sales_amount=record['sales_amount'],
                    synced_at=datetime.utcnow()
                )
                self.db.add(new_record)
                new_count += 1
        
        self.db.commit()
        logger.info(f"Synced {new_count} new and {updated_count} updated hourly sales records")
        return new_count + updated_count
```

**–õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
- –ï—Å–ª–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î ‚Üí –∑–∞–ø–∏—Å—å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–æ–≤–∞—è ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è

---

## ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á:

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **APScheduler** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

```26:67:app/main.py
# Initialize scheduler for automatic sales loading
scheduler = BackgroundScheduler()

@app.on_event("startup")
async def startup_event():
    """Initialize background scheduler on application startup"""
    try:
        # Schedule daily automatic sales loading at 2:00 AM
        scheduler.add_job(
            func=run_auto_sync,
            trigger="cron", 
            hour=2,
            minute=0,
            id='daily_sales_sync',
            name='Daily Sales Auto-Sync',
            replace_existing=True
        )
```

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:**
- **–í—Ä–µ–º—è:** 02:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- **–ó–∞–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```18:70:app/services/scheduled_sales_loader.py
    async def auto_load_sales(self) -> dict:
        """
        Automatically load sales data for the previous day
        This method is called by the scheduler
        """
        db: Session = next(get_db())
        
        try:
            # Calculate date range (previous day) 
            # iiko API requires different from_date and to_date (409 error if same)
            yesterday = date.today() - timedelta(days=1)
            from_date = yesterday
            # Use today as to_date to avoid 409 error
            to_date = date.today()
            
            self.logger.info(f"Starting automatic sales sync for {from_date}")
            
            # Create sales loader service
            sales_loader = IikoSalesLoaderService(db)
            
            # Perform sync
            result = await sales_loader.sync_sales(from_date, to_date)
            
            # Log the auto-sync attempt
            self._log_auto_sync(db, from_date, to_date, result)
            
            if result.get("status") == "success":
                self.logger.info(f"Automatic sales sync completed successfully: {result.get('message')}")
                self.logger.info(f"Records synced - Summary: {result.get('summary_records', 0)}, Hourly: {result.get('hourly_records', 0)}")
            else:
                self.logger.error(f"Automatic sales sync failed: {result.get('message')}")
                
            return result
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è **–≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å** (–ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å)
- `from_date = –≤—á–µ—Ä–∞`, `to_date = —Å–µ–≥–æ–¥–Ω—è` (–∏–∑–±–µ–≥–∞–µ—Ç –æ—à–∏–±–∫—É 409 API)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `AutoSyncLog`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```72:94:app/services/scheduled_sales_loader.py
    def _log_auto_sync(self, db: Session, from_date: date, to_date: date, result: dict):
        """Log automatic sync attempt to database"""
        try:
            log_entry = AutoSyncLog(
                sync_date=from_date,
                sync_type="daily_auto",
                status=result.get("status", "unknown"),
                message=result.get("message", "No message"),
                summary_records=result.get("summary_records", 0),
                hourly_records=result.get("hourly_records", 0),
                total_raw_records=result.get("total_raw_records", 0),
                error_details=result.get("details") if result.get("status") == "error" else None,
                executed_at=datetime.utcnow()
            )
            
            db.add(log_entry)
            db.commit()
            
            self.logger.info(f"Auto-sync log entry created for {from_date}")
            
        except Exception as e:
            self.logger.error(f"Failed to log auto-sync attempt: {e}")
            db.rollback()
```

---

## üéØ –ö–∞–∫–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

**–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç iiko API, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∑–∞–ø–∏—Å–∏ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º.**

### –ü—Ä–æ—Ü–µ—Å—Å:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ iiko API**
   - –ó–∞–ø—Ä–æ—Å –∫ OLAP API –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
   - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤—Å–µ –ø—Ä–æ–¥–∞–∂–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –î–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ `Department.Id`
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º –∏–∑ –æ—Ç–≤–µ—Ç–∞ API

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:**

```164:167:app/services/iiko_sales_loader.py
            dept = self.db.query(Department).filter(Department.id == record['department_id']).first()
            if not dept:
                logger.warning(f"Department {record['department_id']} not found, skipping sales record")
                continue
```

   - –ï—Å–ª–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ **—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î** ‚Üí –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
   - –ï—Å–ª–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ **–ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î** ‚Üí –¥–∞–Ω–Ω—ã–µ **–ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è** (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –≤ –ª–æ–≥)

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–ù–µ—Ç —è–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è**
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏–∑ iiko API
   - –¢–∏–ø—ã –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π: `DEPARTMENT`, `JURPERSON`, `CORPORATION`

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**
   - –¢–æ–ª—å–∫–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `departments`, –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
   - –ï—Å–ª–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ iiko ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
   - –ü–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–¥–∞–∂ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/departments/sync` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π

### –¢–∏–ø—ã –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π:

- **`DEPARTMENT`** - –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–¥–∞–∂) ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –¥–ª—è –ø—Ä–æ–¥–∞–∂**
- **`JURPERSON`** - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞ (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã)
- **`CORPORATION`** - –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏ (–≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤, –Ω–æ –æ–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ç–∏–ø `DEPARTMENT`.

---

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –°–ò–°–¢–ï–ú–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –° iiko                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (IikoAuthService)                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –•—Ä–∞–Ω–µ–Ω–∏–µ: app/services/iiko_auth.py                              ‚îÇ
‚îÇ  –õ–æ–≥–∏–Ω: "Tanat"                                                   ‚îÇ
‚îÇ  –ü–∞—Ä–æ–ª—å: "7c4a8d09ca3762af61e59520943dc26494f8941b"              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –î–æ–º–µ–Ω—ã:                                                          ‚îÇ
‚îÇ  ‚Ä¢ https://sandy-co-co.iiko.it                                    ‚îÇ
‚îÇ  ‚Ä¢ https://madlen-group-so.iiko.it                                ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –ü—Ä–æ—Ü–µ—Å—Å:                                                         ‚îÇ
‚îÇ  GET /resto/api/auth?login=Tanat&pass=***                        ‚îÇ
‚îÇ  ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 60 –º–∏–Ω—É—Ç)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ô (IikoDepartmentLoaderService)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –≠–Ω–¥–ø–æ–∏–Ω—Ç: GET /resto/api/corporation/departments                ‚îÇ
‚îÇ  –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: XML                                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –î–∞–Ω–Ω—ã–µ:                                                          ‚îÇ
‚îÇ  ‚Ä¢ id (UUID)                                                      ‚îÇ
‚îÇ  ‚Ä¢ parent_id (UUID)                                               ‚îÇ
‚îÇ  ‚Ä¢ code, name, type, taxpayer_id_number                          ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:                                                      ‚îÇ
‚îÇ  ‚Üí –¢–∞–±–ª–∏—Ü–∞: departments                                           ‚îÇ
‚îÇ  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ (—Ä–æ–¥–∏—Ç–µ–ª–∏ ‚Üí –¥–µ—Ç–∏)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –ó–ê–ì–†–£–ó–ö–ê –ü–†–û–î–ê–ñ (IikoSalesLoaderService)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –≠–Ω–¥–ø–æ–∏–Ω—Ç: POST /resto/api/v2/reports/olap                        ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –ó–∞–ø—Ä–æ—Å:                                                          ‚îÇ
‚îÇ  {                                                                ‚îÇ
‚îÇ    "reportType": "SALES",                                         ‚îÇ
‚îÇ    "groupByRowFields": ["Department.Id", "CloseTime", "OrderNum"],‚îÇ
‚îÇ    "aggregateFields": ["DishSumInt"],                             ‚îÇ
‚îÇ    "filters": {                                                   ‚îÇ
‚îÇ      "OpenDate.Typed": {DateRange},                               ‚îÇ
‚îÇ      "OrderDeleted": "NOT_DELETED",                              ‚îÇ
‚îÇ      "DeletedWithWriteoff": "NOT_DELETED"                         ‚îÇ
‚îÇ    }                                                              ‚îÇ
‚îÇ  }                                                                ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –ü–æ–ª—É—á–µ–Ω–∏–µ:                                                       ‚îÇ
‚îÇ  ‚Üí –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂ –ø–æ –≤—Å–µ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º                    ‚îÇ
‚îÇ  ‚Üí –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ Department.Id                                    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –û–±—Ä–∞–±–æ—Ç–∫–∞:                                                       ‚îÇ
‚îÇ  ‚Üí –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ (SalesSummary)                              ‚îÇ
‚îÇ  ‚Üí –ü–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏ (SalesByHour)                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. –°–û–•–†–ê–ù–ï–ù–ò–ï –í –ë–î                                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞:                                                        ‚îÇ
‚îÇ  ‚Ä¢ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ departments?                       ‚îÇ
‚îÇ    ‚îú‚îÄ –î–ê ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ                                       ‚îÇ
‚îÇ    ‚îî‚îÄ –ù–ï–¢ ‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –≤ –ª–æ–≥)                  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –¢–∞–±–ª–∏—Ü—ã:                                                         ‚îÇ
‚îÇ  ‚Ä¢ sales_summary (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏)                             ‚îÇ
‚îÇ  ‚Ä¢ sales_by_hour (–ø–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏)                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –õ–æ–≥–∏–∫–∞:                                                          ‚îÇ
‚îÇ  ‚Ä¢ –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –û–±–Ω–æ–≤–∏—Ç—å                              ‚îÇ
‚îÇ  ‚Ä¢ –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–æ–≤–∞—è ‚Üí –°–æ–∑–¥–∞—Ç—å                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø (ScheduledSalesLoaderService)    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫: APScheduler                                         ‚îÇ
‚îÇ  –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00                                    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  –ü—Ä–æ—Ü–µ—Å—Å:                                                         ‚îÇ
‚îÇ  1. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:                                         ‚îÇ
‚îÇ     from_date = –≤—á–µ—Ä–∞                                             ‚îÇ
‚îÇ     to_date = —Å–µ–≥–æ–¥–Ω—è                                             ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  2. –í—ã–∑–æ–≤ IikoSalesLoaderService.sync_sales()                    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:                                      ‚îÇ
‚îÇ     ‚Üí –¢–∞–±–ª–∏—Ü–∞: auto_sync_log                                      ‚îÇ
‚îÇ     ‚Üí –ü–æ–ª—è: status, records, error_details                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:

```
iiko API
  ‚îÇ
  ‚îú‚îÄ> –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (IikoAuthService)
  ‚îÇ
  ‚îú‚îÄ> –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π (IikoDepartmentLoaderService)
  ‚îÇ   ‚îî‚îÄ> departments: [id, name, type, ...]
  ‚îÇ
  ‚îú‚îÄ> –ó–∞–ø—Ä–æ—Å –ø—Ä–æ–¥–∞–∂ (IikoSalesLoaderService)
  ‚îÇ   ‚îî‚îÄ> sales_data: [{Department.Id, CloseTime, DishSumInt}, ...]
  ‚îÇ
  ‚îú‚îÄ> –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  ‚îÇ   ‚îú‚îÄ> –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ Department.Id + date
  ‚îÇ   ‚îÇ   ‚îî‚îÄ> sales_summary: [{department_id, date, total_sales}]
  ‚îÇ   ‚îÇ
  ‚îÇ   ‚îî‚îÄ> –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ Department.Id + date + hour
  ‚îÇ       ‚îî‚îÄ> sales_by_hour: [{department_id, date, hour, sales_amount}]
  ‚îÇ
  ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
  ‚îÇ   ‚îî‚îÄ> –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
  ‚îÇ       ‚îî‚îÄ> –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
  ‚îÇ
  ‚îî‚îÄ> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
      ‚îú‚îÄ> sales_summary (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏)
      ‚îî‚îÄ> sales_by_hour (–ø–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏)
```

---

## üìù –†–µ–∑—é–º–µ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –•—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ (`app/services/iiko_auth.py`)
   - –û–¥–∏–Ω –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤
   - ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

2. **–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:**
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ iiko API (`/resto/api/corporation/departments`)
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `departments`
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏

3. **–ü—Ä–æ–¥–∞–∂–∏:**
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–ª—è **–≤—Å–µ—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π** –∏–∑ –æ—Ç–≤–µ—Ç–∞ iiko API
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤ –ë–î
   - –ê–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏ –ø–æ—á–∞—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `auto_sync_log`

5. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
   - –ù–µ—Ç —è–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ë–î)
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ–¥–∞–∂

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –í—ã–Ω–µ—Å—Ç–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ –∑–∞–ø–∏—Å–µ–π –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–¥–∞–∂

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –î–æ–±–∞–≤–∏—Ç—å –±–∞—Ç—á–∏–Ω–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2024-12-19  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 0.1.0

