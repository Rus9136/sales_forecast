#!/usr/bin/env python3
"""
–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∞ "–§–∞–∫—Ç vs –ü—Ä–æ–≥–Ω–æ–∑"
"""
import requests
import json

BASE_URL = "http://localhost:8002"

def test_chart_functionality():
    print("=" * 60)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ì–†–ê–§–ò–ö–ê '–§–ê–ö–¢ vs –ü–†–û–ì–ù–û–ó'")
    print("=" * 60)
    
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    print("\n1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
    try:
        response = requests.get(f"{BASE_URL}/")
        if response.status_code == 200:
            print("   ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞")
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Chart.js
            if "chart.js" in response.text:
                print("   ‚úÖ Chart.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞")
            else:
                print("   ‚ùå Chart.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ù–ï –Ω–∞–π–¥–µ–Ω–∞")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞
            if "forecast-chart-wrapper" in response.text:
                print("   ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞–π–¥–µ–Ω")
            else:
                print("   ‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞ –ù–ï –Ω–∞–π–¥–µ–Ω")
                
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π Chart.js
            if "updateForecastChart" in response.text:
                print("   ‚úÖ –§—É–Ω–∫—Ü–∏—è updateForecastChart –Ω–∞–π–¥–µ–Ω–∞")
            else:
                print("   ‚ùå –§—É–Ω–∫—Ü–∏—è updateForecastChart –ù–ï –Ω–∞–π–¥–µ–Ω–∞")
        else:
            print(f"   ‚ùå –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: {response.status_code}")
            return False
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {e}")
        return False
    
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º API —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
    print("\n2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤...")
    try:
        url = f"{BASE_URL}/api/forecast/comparison?from_date=2025-06-01&to_date=2025-06-05"
        response = requests.get(url)
        if response.status_code == 200:
            data = response.json()
            print(f"   ‚úÖ API —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–∞–π–¥–µ–Ω–æ {len(data)} –∑–∞–ø–∏—Å–µ–π")
            
            # –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã
            departments = list(set(item['department_id'] for item in data))
            if departments:
                print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è {len(departments)} —Ñ–∏–ª–∏–∞–ª–æ–≤")
                
                # –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
                test_dept = departments[0]
                dept_data = [item for item in data if item['department_id'] == test_dept]
                dept_name = dept_data[0]['department_name']
                
                print(f"\n   –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∏–ª–∏–∞–ª: {dept_name}")
                print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π: {len(dept_data)}")
                
                # –í—ã–≤–æ–¥–∏–º –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
                print("   –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:")
                for item in dept_data[:3]:  # –ü–µ—Ä–≤—ã–µ 3 –∑–∞–ø–∏—Å–∏
                    date = item['date']
                    pred = item['predicted_sales']
                    actual = item['actual_sales']
                    error_pct = item['error_percentage']
                    print(f"     {date}: –ü—Ä–æ–≥–Ω–æ–∑={pred:,.0f}‚Ç∏, –§–∞–∫—Ç={actual:,.0f}‚Ç∏, –û—à–∏–±–∫–∞={error_pct:.1f}%")
                
                return True
            else:
                print("   ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª–æ–≤")
                return False
        else:
            print(f"   ‚ùå API —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ: {response.status_code}")
            return False
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞ API —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: {e}")
        return False
    
    # 3. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    print("\n" + "=" * 60)
    print("–ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –†–£–ß–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 60)
    
    print("\nüîó –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8002/")
    print("\nüìã –®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print("1. –í –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ '–ü–†–û–ì–ù–û–ó –ü–†–û–î–ê–ñ'")
    print("2. –í—ã–±–µ—Ä–∏—Ç–µ 'üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç / –ø—Ä–æ–≥–Ω–æ–∑'")
    print("3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–∏–æ–¥: —Å 2025-06-01 –ø–æ 2025-06-05")
    print("4. –í –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤—ã–±–µ—Ä–∏—Ç–µ '–ú–∞–¥–ª–µ–Ω Plaza' (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ñ–∏–ª–∏–∞–ª)")
    print("5. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–ó–∞–≥—Ä—É–∑–∏—Ç—å'")
    
    print("\n‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:")
    print("‚Ä¢ –ü–æ—è–≤–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–∞–∫—Ç/–ø—Ä–æ–≥–Ω–æ–∑")
    print("‚Ä¢ –ù–ê–î —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ—è–≤–∏—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫ —Å –¥–≤—É–º—è –ª–∏–Ω–∏—è–º–∏:")
    print("  - –°–∏–Ω—è—è –ª–∏–Ω–∏—è: –ü—Ä–æ–≥–Ω–æ–∑")
    print("  - –ó–µ–ª—ë–Ω–∞—è –ª–∏–Ω–∏—è: –§–∞–∫—Ç")
    print("‚Ä¢ –û—Å—å X: –¥–∞—Ç—ã")
    print("‚Ä¢ –û—Å—å Y: —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –≤ —Ç–µ–Ω–≥–µ")
    print("‚Ä¢ –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ç–æ—á–∫–∏ - –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏")
    
    print("\n‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ª–æ–≤–∏—è:")
    print("‚Ä¢ –ì—Ä–∞—Ñ–∏–∫ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ '–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'")
    print("‚Ä¢ –ì—Ä–∞—Ñ–∏–∫ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö")
    print("‚Ä¢ –ì—Ä–∞—Ñ–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ —Ç–∞–±–ª–∏—Ü—ã")
    
    print("\nüéØ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è:")
    print("‚Ä¢ –ú–∞–¥–ª–µ–Ω Plaza (ID: 0d30c200-87b5-45a5-89f0-eb76e2892b4a)")
    print("‚Ä¢ –ú–∞–¥–ª–µ–Ω –ê—ç—Ä–æ–ø–æ—Ä—Ç (ID: 138ca7c6-1741-4ba9-8342-1a239a514308)")
    print("‚Ä¢ –ú–∞–¥–ª–µ–Ω –ö–æ–ª–æ—Å (ID: 18d35be9-4ac6-4ad0-8351-373ed9a7bcac)")
    print("‚Ä¢ –ò –¥—Ä—É–≥–∏–µ —Ñ–∏–ª–∏–∞–ª—ã –∑–∞ –ø–µ—Ä–∏–æ–¥ 01-05 –∏—é–Ω—è 2025")

if __name__ == "__main__":
    test_chart_functionality()